<% if logged_in? %>

<h1>Current Appointments</h1>

<% if current_tutor %>
<!-- Begin Tutor-Only Portion -->
    <% if Appointment.where("cancelled = ?", false).size == 0 %>
      <p>You do not have any current appointments.</p>
    <% else %>
    <div class="table-responsive clearfix">
    <table class="table table-hover">
    <thead>
    <tr>
    <th><span>Student</span></th>
    <th><span>Tutor</span></th>
    <th><span>Date</span></th>
    <th class="text-center"><span>Status</span></th>
    <th class="text-center"><span></span></th>
    </tr>
    </thead>
    <tbody>
      <% Appointment.where("cancelled = ? AND confirmed = ?", false, true).each do |appointment| %>
      <tr>
      <td>
      <%= appointment.list_students %>
      </td>
      <td>
      <%= appointment.tutor.name %>
      </td>
      <td>
      <%= appointment.window.name %>
      </td>
      <td class="text-center">

        <% if appointment.confirmed %>
        <span class="label label-success">
          Confirmed
        </span>
        <% else %>
        <span class="label label-warning">
          Pending
        </span>
        <% end %>
      </td>
      <td class="text-center" style="width: 15%;">
        <% if appointment.confirmed %>
          <%= link_to "/appointments/#{appointment.id}/cancel", class: 'table-link' do %>
            <span class="fa-stack">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-close fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
        <% else %>
          <%= link_to "/appointments/#{appointment.id}/confirm", class: 'table-link' do %>
            <span class="fa-stack">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-check fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
        <% end %>
      </td>
      </tr>
      <% end %>

      <% Appointment.where("cancelled = ? AND confirmed = ?", false, false).each do |appointment| %>
      <tr>
      <td>
      <%= appointment.list_students %>
      </td>
      <td>
      <%= appointment.tutor.name %>
      </td>
      <td>
      <%= appointment.window.name %>
      </td>
      <td class="text-center">

        <% if appointment.confirmed %>
        <span class="label label-success">
          Confirmed
        </span>
        <% else %>
        <span class="label label-warning">
          Pending
        </span>
        <% end %>
      </td>
      <td class="text-center" style="width: 15%;">
        <% if appointment.confirmed %>
          <%= link_to "/appointments/#{appointment.id}/cancel", class: 'table-link' do %>
            <span class="fa-stack">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-close fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
        <% else %>
          <%= link_to "/appointments/#{appointment.id}/confirm", class: 'table-link' do %>
            <span class="fa-stack">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-check fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
        <% end %>
      </td>
      </tr>
      <% end %>
        </tbody>
        </table>
        </div>
    </ul>
    <% end %>
<!-- End Tutor-Only Portion -->
<% elsif current_student %>
<!-- Begin Student-Only Portion -->
    <% if Appointment.where("cancelled = ?", false).size == 0 %>
      <p>You do not have any current appointments.</p>
    <% else %>
      <div class="table-responsive clearfix">
      <table class="table table-hover">
      <thead>
      <tr>
      <th><span>Student</span></th>
      <th><span>Tutor</span></th>
      <th><span>Date</span></th>
      <th class="text-center"><span>Status</span></th>
      <th class="text-center"><span></span></th>
      </tr>
      </thead>
      <tbody>
      <% Appointment.where("cancelled = ?", false).each do |appointment| %>
        <tr>
        <td>
        <%= appointment.list_students %>
        </td>
        <td>
        <%= appointment.tutor.name %>
        </td>
        <td>
        <%= appointment.window.name %>
        </td>
        <td class="text-center">
          <% if appointment.confirmed %>
          <span class="label label-success">
            Confirmed
          </span>
          <% else %>
          <span class="label label-warning">
            Pending
          </span>
          <% end %>
        </td>
        <td class="text-center" style="width: 15%;">
          <%= link_to "/appointments/#{appointment.id}/cancel", class: 'table-link' do %>
          <span class="fa-stack">
          <i class="fa fa-square fa-stack-2x"></i>
          <i class="fa fa-close fa-stack-1x fa-inverse"></i>
          </span>
          <% end %>
        </td>
        </tr>
      <% end %>
      </tbody>
      </table>
      </div>
    </ul>
    <% end %>


  <h1>Make a New Appointment</h1>

  <h3>What do you need help with?</h3>

    <%= form_tag('/appointments/search') do %>
      <%= collection_check_boxes(:skills, :skill_ids, Skill.all, :id, :name) do |b| %>
      <div class="checkbox-nice checkbox-inline">
        <%= b.check_box %>
        <%=  b.label(class: "checkbox-inline") %>
       </div>
      <% end %>

  <h3>When would you like to meet with a tutor?</h3>

      <%= collection_check_boxes(:windows, :window_ids, Window.all, :id, :name) do |b| %>
        <div class="checkbox-nice checkbox-inline">
          <%= b.check_box %>
          <%= b.label(class: "checkbox-inline") %>
        </div>
        <br>
      <% end %><br>

      <div><%= submit_tag 'Search for Available Tutors', class: 'btn btn-default' %></div>

  <% end %>

<% end %>

<!-- End Student-Only Portion -->

<% else %>

<div class="row">
  <div class="col-xs-12 col-sm-6">
    <button type="submit" class="btn btn-primary col-xs-12 btn-github">
      <i class="fa fa-github"></i><a href="/student/new"> Student Login</a>
    </button>
  </div>
  <div class="col-xs-12 col-sm-6">
    <button type="submit" class="btn btn-primary col-xs-12 btn-github">
      <i class="fa fa-github"></i><a href="/tutor/new"> Tutor Login</a>
    </button>
  </div>
</div>


<% end %>